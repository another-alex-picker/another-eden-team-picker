<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>貓神健檢小幫手</title>

    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <!-- clipboard.js v2.0.4 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>

    <!-- Latest CSS JS -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.15.5/bootstrap-table.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.15.5/bootstrap-table.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>

    <script type="text/javascript">
        var whiteText = '&emsp;';
        var spaceText = '＿';
        var divide = ' | ';

        function stringPad(str, target, type) {
            var strLength = 0;
            strLength = findLength(str);
            if (strLength < target){
                var pad = "";
                for (var i = 0; i < (target - Math.ceil(strLength)); i++){
                    pad += spaceText;
                }
                if (type == "<"){
                    return ((Math.ceil(strLength) - Math.floor(strLength))?" ":"") + pad + str;
                }else if (type == ">"){
                    return str + pad + ((Math.ceil(strLength) - Math.floor(strLength))?"&ensp;":"");
                }
            }
            return str;
        }

        function strLoop(str, target){
            var loop = "";
            for (var i = 0; i < Math.ceil(target); i++){
                loop += str;
            }
            return loop;
        }

        function findLength(str){
            var length, half, full, chi = 0;
            half = str.match(/[\u0000-\u00ff]/g) || [];	//半形
            chi = str.match(/[\u4e00-\u9fa5]/g) || [];	    //中文
            full = str.match(/[\uff00-\uffff]/g) || [];	    //全形

            return (half.length / 2) + chi.length + full.length;
        }

        function findMaxLength(data){
            var nameMax = 0;
            var nicknameMax = 0;

            $.map(data, function(row, i){
                var nameLength, nicknameLength = 0;
                nameLength = findLength(row["name"]);
                nicknameLength = findLength(row["nickname"]);
                if (nameLength > nameMax) nameMax = nameLength;
                if (nicknameLength > nicknameMax) nicknameMax = nicknameLength;
            });

            return [nameMax, nicknameMax];
        }


        function toFixLength(i, j, target){
            var name, nickname = "";

            name = stringPad(i, target[0], ">");
            nickname = stringPad(j, target[1], "<");

            return name + divide + nickname;
        }


        $(document).ready(function () {

            var clipboard = new ClipboardJS('.copybtn');
            clipboard.on('success', function(e) {
                bootbox.alert({
                    title: "已複製到剪貼簿",
                    message: "小提示︰健檢表格請在置頂的集中串中回應喔♪"
                });
                e.clearSelection();
            });

            clipboard.on('error', function(e) {
                bootbox.alert({
                    title: "複製到剪貼簿失敗",
                    message: "請手動進行複製"
                });
                console.error('Action:', e.action);
            });


            $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {

                if (e.target.id = "gentabel-tab"){
                    var data = $("#char_table").bootstrapTable('getData');

                    var tbody = $.map(data, function(row, i){
                        var hoshi = '<font color="lightgray">-</font>';
                        if (row["had5"] === true){
                            hoshi = "<strong>★5</strong>";
                        }else if(row["had4"]){
                            hoshi = '<font color="gray">☆4</font>';
                        }
                        var as = row["hadas"]?"<strong>✓</strong>":'<font color="lightgray">-</font>';
                        return [
                            '<tr height="20">',
                            '<td width="80">'+row["name"]+'</td>',
                            '<td align="right" width="90">'+row["nickname"]+'</td>',
                            '<td align="center">'+hoshi+'</td>',
                            '<td align="center"'+(row["as"]?"":' bgcolor="lightgray"')+'>'+as+'</td>',
                            '</tr>',
                        ].join('\n');

                    }).join('\n');


                    var table = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-tw">',
                        '<head><title>貓神健檢小幫手</title></head>',
                        '<style>th,td{padding:2px;}</style>',
                        '<body>',
                        '<br><br><br>',
                        '<table border=1 style="border-style: solid; border-collapse: collapse;">',
                        '<thead>',
                        '<tr height="20">',
                        '<th width="170" colspan="2"><strong>角色</strong></th>',
                        '<th width="50"><strong>原版</strong></th>',
                        '<th width="50"><strong>AS版</strong></th>',
                        '</tr>',
                        '</thead>',
                        '<tbody>',
                        tbody,
                        '</tbody>',
                        '</table>',
                        '<br><br><br><br>'
                    ].join("\n");

                    $("#editor1").html(table);
                }


                if (e.target.id = "gentext-tab"){
                    var data = $("#char_table").bootstrapTable('getData');
                    var nameMaxLength = findMaxLength(data);

                    var list = $.map(data, function(row, i){
                        var hoshi = spaceText + spaceText;
                        if (row["had5"] === true){
                            hoshi = "★５";
                        }else if(row["had4"]){
                            hoshi = '☆４';
                        }
                        var as = row["hadas"]?"★":row["as"]? spaceText:"／";

                        return divide + toFixLength(row["name"], row["nickname"], nameMaxLength) + divide + hoshi + divide + as + divide;
                    });

                    var html = [
                        '<!DOCTYPE html>',
                        '<html lang="zh-tw">',
                        '<head><title>貓神健檢小幫手</title></head>',
                        '<style>th,td{padding:2px;}</style>',
                        '<body>',
                        '<br><br><br>',
                        "<span>" + divide + toFixLength("角色", "暱稱", nameMaxLength) + divide + "原版" + divide + "AS" + divide +

                        "</span><br />",
                        "<span>" + divide + toFixLength(strLoop("＿", nameMaxLength[0]), strLoop("＿", nameMaxLength[1]), nameMaxLength) +

                        divide + "＿＿" + divide + "＿" + divide + "</span><br />",
                        list.join("<br />"),
                        '<br><br><br><br>'
                    ].join("\n");


                    $("#editor2").html(html);
                }

            });

            window.operateEvents = {
                'click .had4': function (e, value, row, index) {
                    if (!row["had4"]){
                        row["had4"] = true;
                    }else{
                        row["had4"] = false;
                        if(row["had5"] == true) row["had5"] = false;
                    }
                    $('#char_table').bootstrapTable('updateRow', {index: index, row: row});
                },
                'click .had5': function (e, value, row, index) {
                    if (!row["had5"]){
                        row["had5"] = true;
                        row["had4"] = true;
                    }else{
                        row["had5"] = false;
                    }
                    $('#char_table').bootstrapTable('updateRow', {index: index, row: row});
                },
                'click .hadas': function (e, value, row, index) {
                    if (!row["hadas"]){
                        row["hadas"] = true;
                    }else{
                        row["hadas"] = false;
                    }
                    $('#char_table').bootstrapTable('updateRow', {index: index, row: row});
                },

            }


            $('#char_table').bootstrapTable({
                columns: [{
                    field: 'id',
                    visible: false
                }, {
                    field: 'name',
                    width: 100
                }, {
                    field: 'had4',
                    width: 40,
                    align: "center",
                    formatter: function(value, row, index){
                        if(value){
                            return '<i class="fa fa-heart had4" style="color:red"></i>';
                        }else{
                            return '<i class="fa fa-heart had4" style="color:#aaa"></i>';
                        }
                    },
                    events: operateEvents
                }, {
                    field: 'had5',
                    width: 40,
                    align: "center",
                    formatter: function(value, row, index){
                        if(value == "none"){
                            return '<font color="gray">-</font>';
                        }else if(value){
                            return '<i class="fa fa-heart had5" style="color:red"></i>';
                        }else{
                            return '<i class="fa fa-heart had5" style="color:#aaa"></i>';
                        }
                    },
                    events: operateEvents
                }, {
                    field: 'hadas',
                    width: 40,
                    align: "center",
                    formatter: function(value, row, index){
                        if ($.trim(row["as"])) {
                            if(value){
                                return '<i class="fa fa-user-friends hadas" style="color:red"></i>';
                            }else{
                                return '<i class="fa fa-user-friends hadas" style="color:#aaa"></i>';
                            }
                        }else{
                            return '<font color="gray">-</font>';
                        }
                    },
                    events: operateEvents
                }, {
                    field: 'as',
                    visible: false
                }, {
                    field: 'nickname'
                }],
                classes: "table table-bordered table-striped table-sm table-borderless",
                theadClasses: "thead-dark"

            });

            $("button#gen").on('click', function(){
                var table = $('#editor1').html();

                var myWindow = window.open("", "_blank");
                myWindow.document.write(table);
            });

            $("button#gentext").on('click', function(){
                var html = $('#editor2').html();

                var myWindow = window.open("", "_blank");
                myWindow.document.write(html);
            });

        });

    </script>

</head>
<body>

<ul class="nav nav-pills" id="myTab" role="tablist" style="min-height:40px">
    <li class="nav-item">
        <a class="nav-link active" id="list-tab" data-toggle="tab" href="#list" role="tab" aria-controls="list" aria-

           selected="true">角色表</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="gentable-tab" data-toggle="tab" href="#gentable" role="tab" aria-controls="gentable"

           aria-selected="false">生成表格</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="gentext-tab" data-toggle="tab" href="#gentexttable" role="tab" aria-controls="gentext"

           aria-selected="false">生成純文字</a>
    </li>
</ul>



<div class="tab-content" id="myTabContent">

    <div class="tab-pane fade show active" id="list" role="tabpanel" aria-labelledby="list-tab">
        <table id="char_table" class="table table-bordered table-striped table-sm table-borderless">
            <thead class="thead-dark">
            <tr>
                <th></th>
                <th>角色</th>
                <th>☆4</th>
                <th>★5</th>
                <th>AS</th>
                <th>AS</th>
                <th>暱稱</th>
            </tr>
            </thead>
            <tbody>

            <tr>
                <td>1</td>
                <td>洛基德</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS狗頭</td>
                <td>狗頭</td>
            </tr>
            <tr>
                <td>2</td>
                <td>麥提</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS麥提</td>
                <td>水法</td>
            </tr>
            <tr>
                <td>3</td>
                <td>杜娃</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS杜娃</td>
                <td>老太婆</td>
            </tr>
            <tr>
                <td>4</td>
                <td>紫央</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS紫央</td>
                <td>茜他哥</td>
            </tr>
            <tr>
                <td>5</td>
                <td>瑪莉艾爾</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS瑪莉</td>
                <td>瑪莉</td>
            </tr>
            <tr>
                <td>6</td>
                <td>蘇賽特</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS蘇賽特</td>
                <td>中二</td>
            </tr>
            <tr>
                <td>7</td>
                <td>安娜貝爾</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>王城之劍</td>
            </tr>
            <tr>
                <td>8</td>
                <td>拉克萊兒</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS水弓</td>
                <td>水弓</td>
            </tr>
            <tr>
                <td>9</td>
                <td>伊絲卡</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS伊絲卡</td>
                <td>會長</td>
            </tr>
            <tr>
                <td>10</td>
                <td>由奈</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS巫女</td>
                <td>巫女</td>
            </tr>
            <tr>
                <td>11</td>
                <td>娜基</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS娜基</td>
                <td>章魚妹</td>
            </tr>
            <tr>
                <td>12</td>
                <td>尤因</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>火槌叔</td>
            </tr>
            <tr>
                <td>13</td>
                <td>謝提</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>火槍哥</td>
            </tr>
            <tr>
                <td>14</td>
                <td>謝奈</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS水劍</td>
                <td>水劍</td>
            </tr>
            <tr>
                <td>15</td>
                <td>玫莉娜</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS玫莉娜</td>
                <td>水槌</td>
            </tr>
            <tr>
                <td>16</td>
                <td>繆露絲</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>魔獸妹</td>
            </tr>
            <tr>
                <td>17</td>
                <td>菲露米娜</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>紙巾美腿</td>
            </tr>
            <tr>
                <td>18</td>
                <td>貝特朗</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>獨眼</td>
            </tr>
            <tr>
                <td>19</td>
                <td>月華</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>妖刀妹</td>
            </tr>
            <tr>
                <td>20</td>
                <td>克勞特</td>
                <td></td>
                <td></td>
                <td></td>
                <td>AS克勞特</td>
                <td>國王</td>
            </tr>
            <tr>
                <td>21</td>
                <td>夏濃</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>偽娘大姊</td>
            </tr>
            <tr>
                <td>22</td>
                <td>雷莉</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>金髮監察官</td>
            </tr>
            <tr>
                <td>23</td>
                <td>艾露嘉</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>貓刀</td>
            </tr>
            <tr>
                <td>24</td>
                <td>維娜</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>風法</td>
            </tr>
            <tr>
                <td>25</td>
                <td>杜伊</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>水拳</td>
            </tr>
            <tr>
                <td>26</td>
                <td>伊露露</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>１６６死神</td>
            </tr>
            <tr>
                <td>27</td>
                <td>拉蒂卡</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>塔羅妹</td>
            </tr>
            <tr>
                <td>28</td>
                <td>皓月</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>騷狐</td>
            </tr>
            <tr>
                <td>29</td>
                <td>維婭卡</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>風槌</td>
            </tr>
            <tr>
                <td>30</td>
                <td>燕</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>土忍</td>
            </tr>
            <tr>
                <td>31</td>
                <td>時雨</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>水刀</td>
            </tr>
            <tr>
                <td>32</td>
                <td>蘿潔塔</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>火補</td>
            </tr>
            <tr>
                <td>33</td>
                <td>茜</td>
                <td></td>
                <td>none</td>
                <td></td>
                <td>AS茜</td>
                <td>紫央妹</td>
            </tr>
            <tr>
                <td>34</td>
                <td>菲羅</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>水斧</td>
            </tr>
            <tr>
                <td>35</td>
                <td>拉布莉</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>火蘿</td>
            </tr>
            <tr>
                <td>36</td>
                <td>杜拿利斯</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>風補</td>
            </tr>
            <tr>
                <td>37</td>
                <td>希斯梅娜</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>水槍</td>
            </tr>
            <tr>
                <td>38</td>
                <td>路伊娜</td>
                <td></td>
                <td>none</td>
                <td></td>
                <td>AS路伊娜</td>
                <td>學園風紀</td>
            </tr>
            <tr>
                <td>39</td>
                <td>普蕾米婭</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>機娘</td>
            </tr>
            </tbody>
        </table>
        <div class="alert alert-primary" role="alert">
            小提示︰健檢表格請在置頂的集中串中回應喔♪
        </div>
    </div>

    <div class="tab-pane fade" id="gentable" role="tabpanel" aria-labelledby="gentable-tab">
        <button type="button" class="btn btn-success btn-block" id="gen">在新視窗開啟</button>
        <button type="button" class="btn btn-info btn-block copybtn" id="copytable" data-clipboard-target="#editor1">複製到剪

            貼簿</button>
        <div id="editor1" contentEditable="false"></div>
    </div>

    <div class="tab-pane fade" id="gentexttable" role="tabpanel" aria-labelledby="gentext-tab">
        <button type="button" class="btn btn-success btn-block" id="gentext">在新視窗開啟</button>
        <button type="button" class="btn btn-info btn-block copybtn" id="copytext" data-clipboard-target="#editor2">複製到剪

            貼簿</button>
        <div id="editor2" contentEditable="false"></div>
    </div>


</div>
</body>
</html>